openapi: 3.0.3
info:
  title: NobodyClimb Backend API
  version: 1.0.0
  description: |
    Backend API for NobodyClimb climbing community platform.

    Features:
    - User authentication and profile management
    - Content creation (posts, galleries)
    - Climbing gym information
    - Social features (comments, likes, bookmarks)
    - YouTube video integration
    - Search and filtering

    All timestamps are in ISO 8601 format. All IDs are strings.
  contact:
    name: NobodyClimb API Team
    email: api@nobodyclimb.com
  license:
    name: MIT

servers:
  - url: http://localhost:8000/api/v1
    description: Local development server
  - url: https://api.nobodyclimb.com/api/v1
    description: Production server
  - url: https://staging-api.nobodyclimb.com/api/v1
    description: Staging server

tags:
  - name: Authentication
    description: User authentication and registration
  - name: Users
    description: User profile management
  - name: Posts
    description: Blog posts and articles
  - name: Tags
    description: Content categorization
  - name: Gyms
    description: Climbing gym information
  - name: Galleries
    description: Photo galleries and albums
  - name: Comments
    description: Comments and replies
  - name: Videos
    description: YouTube video integration
  - name: Bookmarks
    description: User saved items
  - name: Search
    description: Global search functionality

security:
  - BearerAuth: []

paths:
  # ==================== AUTHENTICATION ====================
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register new user
      description: Create a new user account
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
              properties:
                username:
                  type: string
                  minLength: 3
                  maxLength: 150
                  pattern: '^[a-zA-Z0-9_]+$'
                  example: climber123
                email:
                  type: string
                  format: email
                  example: climber@example.com
                password:
                  type: string
                  minLength: 8
                  example: SecurePass123!
                displayName:
                  type: string
                  maxLength: 100
                  example: John Climber
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  tokens:
                    $ref: '#/components/schemas/TokenPair'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Username or email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Username already exists

  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and receive JWT tokens
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: climber123
                password:
                  type: string
                  example: SecurePass123!
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  tokens:
                    $ref: '#/components/schemas/TokenPair'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get a new access token using refresh token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh
              properties:
                refresh:
                  type: string
                  description: Refresh token
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  access:
                    type: string
                    description: New access token
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: Retrieve authenticated user's profile
      responses:
        '200':
          description: User profile retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ==================== USERS ====================
  /users:
    get:
      tags:
        - Users
      summary: List users
      description: Get paginated list of users
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: search
          in: query
          schema:
            type: string
          description: Search by username or display name
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'

  /users/{id}:
    get:
      tags:
        - Users
      summary: Get user by ID
      description: Retrieve a specific user's profile
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Users
      summary: Update user profile
      description: Update authenticated user's profile (users can only update their own profile)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                displayName:
                  type: string
                  maxLength: 100
                bio:
                  type: string
                avatar:
                  type: string
                  format: uri
                climbingStartYear:
                  type: string
                  pattern: '^\d{4}$'
                frequentGym:
                  type: string
                  maxLength: 200
                favoriteRouteType:
                  type: string
                  maxLength: 50
                socialLinks:
                  $ref: '#/components/schemas/SocialLinks'
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Users
      summary: Delete user account
      description: Delete authenticated user's account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Account deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /users/{id}/posts:
    get:
      tags:
        - Users
      summary: Get user's posts
      description: Retrieve all posts by a specific user
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: User posts retrieved
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Post'

  /users/{id}/galleries:
    get:
      tags:
        - Users
      summary: Get user's galleries
      description: Retrieve all galleries by a specific user
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: User galleries retrieved
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Gallery'

  /users/{id}/bookmarks:
    get:
      tags:
        - Users
      summary: Get user's bookmarks
      description: Retrieve authenticated user's bookmarked items
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: contentType
          in: query
          schema:
            type: string
            enum: [post, gym, gallery, video]
          description: Filter by content type
      responses:
        '200':
          description: Bookmarks retrieved
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Bookmark'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  # ==================== POSTS ====================
  /posts:
    get:
      tags:
        - Posts
      summary: List posts
      description: Get paginated list of published posts
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: tag
          in: query
          schema:
            type: string
          description: Filter by tag slug
        - name: author
          in: query
          schema:
            type: string
          description: Filter by author ID
        - name: search
          in: query
          schema:
            type: string
          description: Search in title and content
      responses:
        '200':
          description: Posts retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Post'

    post:
      tags:
        - Posts
      summary: Create post
      description: Create a new blog post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - content
                - summary
                - coverImage
              properties:
                title:
                  type: string
                  maxLength: 200
                content:
                  type: string
                  description: Markdown content
                summary:
                  type: string
                  maxLength: 500
                coverImage:
                  type: string
                  format: uri
                images:
                  type: array
                  items:
                    type: string
                    format: uri
                tags:
                  type: array
                  items:
                    type: string
                  description: Array of tag slugs
                isPublished:
                  type: boolean
                  default: false
      responses:
        '201':
          description: Post created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /posts/{slug}:
    get:
      tags:
        - Posts
      summary: Get post by slug
      description: Retrieve a specific post (increments view count)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Post retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Posts
      summary: Update post
      description: Update an existing post (author only)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  maxLength: 200
                content:
                  type: string
                summary:
                  type: string
                  maxLength: 500
                coverImage:
                  type: string
                  format: uri
                images:
                  type: array
                  items:
                    type: string
                    format: uri
                tags:
                  type: array
                  items:
                    type: string
                isPublished:
                  type: boolean
      responses:
        '200':
          description: Post updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Posts
      summary: Delete post
      description: Delete a post (author only)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Post deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /posts/{slug}/like:
    post:
      tags:
        - Posts
      summary: Like post
      description: Like or unlike a post (toggle)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Post liked/unliked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  liked:
                    type: boolean
                    description: Current like status
                  likes:
                    type: integer
                    description: Total like count
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /posts/{slug}/comments:
    get:
      tags:
        - Posts
      summary: Get post comments
      description: Retrieve all comments for a post
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: Comments retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Comment'

    post:
      tags:
        - Posts
      summary: Create post comment
      description: Add a comment to a post
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 5000
                parentId:
                  type: string
                  description: Parent comment ID for replies
      responses:
        '201':
          description: Comment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== TAGS ====================
  /tags:
    get:
      tags:
        - Tags
      summary: List tags
      description: Get all tags
      parameters:
        - name: search
          in: query
          schema:
            type: string
          description: Search tags by name
      responses:
        '200':
          description: Tags retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tag'

    post:
      tags:
        - Tags
      summary: Create tag
      description: Create a new tag (admin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  maxLength: 50
      responses:
        '201':
          description: Tag created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /tags/{slug}:
    get:
      tags:
        - Tags
      summary: Get tag by slug
      description: Retrieve a specific tag
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Tag retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tag'
        '404':
          $ref: '#/components/responses/NotFound'

  /tags/{slug}/posts:
    get:
      tags:
        - Tags
      summary: Get posts by tag
      description: Retrieve all posts with a specific tag
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: Tagged posts retrieved
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Post'

  # ==================== GYMS ====================
  /gyms:
    get:
      tags:
        - Gyms
      summary: List gyms
      description: Get paginated list of climbing gyms
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: search
          in: query
          schema:
            type: string
          description: Search by gym name or address
        - name: orderBy
          in: query
          schema:
            type: string
            enum: [createdAt, rating, likes]
          description: Sort order
      responses:
        '200':
          description: Gyms retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Gym'

    post:
      tags:
        - Gyms
      summary: Create gym
      description: Add a new climbing gym
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - description
                - address
                - coverImage
              properties:
                name:
                  type: string
                  maxLength: 200
                description:
                  type: string
                address:
                  type: string
                  maxLength: 500
                coverImage:
                  type: string
                  format: uri
                images:
                  type: array
                  items:
                    type: string
                    format: uri
                website:
                  type: string
                  format: uri
                phone:
                  type: string
                  maxLength: 20
                openingHours:
                  $ref: '#/components/schemas/OpeningHours'
                facilities:
                  type: array
                  items:
                    type: string
      responses:
        '201':
          description: Gym created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Gym'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /gyms/{slug}:
    get:
      tags:
        - Gyms
      summary: Get gym by slug
      description: Retrieve a specific gym
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Gym retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Gym'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Gyms
      summary: Update gym
      description: Update gym information (admin only)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 200
                description:
                  type: string
                address:
                  type: string
                  maxLength: 500
                coverImage:
                  type: string
                  format: uri
                images:
                  type: array
                  items:
                    type: string
                    format: uri
                website:
                  type: string
                  format: uri
                phone:
                  type: string
                  maxLength: 20
                openingHours:
                  $ref: '#/components/schemas/OpeningHours'
                facilities:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Gym updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Gym'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Gyms
      summary: Delete gym
      description: Delete a gym (admin only)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Gym deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /gyms/{slug}/like:
    post:
      tags:
        - Gyms
      summary: Like gym
      description: Like or unlike a gym (toggle)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Gym liked/unliked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  liked:
                    type: boolean
                  likes:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /gyms/{slug}/comments:
    get:
      tags:
        - Gyms
      summary: Get gym comments
      description: Retrieve all comments for a gym
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: Comments retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Comment'

    post:
      tags:
        - Gyms
      summary: Create gym comment
      description: Add a comment to a gym
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 5000
                parentId:
                  type: string
      responses:
        '201':
          description: Comment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== GALLERIES ====================
  /galleries:
    get:
      tags:
        - Galleries
      summary: List galleries
      description: Get paginated list of galleries
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: author
          in: query
          schema:
            type: string
          description: Filter by author ID
      responses:
        '200':
          description: Galleries retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Gallery'

    post:
      tags:
        - Galleries
      summary: Create gallery
      description: Create a new photo gallery
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - coverImage
              properties:
                title:
                  type: string
                  maxLength: 200
                description:
                  type: string
                coverImage:
                  type: string
                  format: uri
      responses:
        '201':
          description: Gallery created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Gallery'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /galleries/{slug}:
    get:
      tags:
        - Galleries
      summary: Get gallery by slug
      description: Retrieve a specific gallery with images (increments view count)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Gallery retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GalleryDetail'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Galleries
      summary: Update gallery
      description: Update gallery information (author only)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  maxLength: 200
                description:
                  type: string
                coverImage:
                  type: string
                  format: uri
      responses:
        '200':
          description: Gallery updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Gallery'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Galleries
      summary: Delete gallery
      description: Delete a gallery (author only)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Gallery deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /galleries/{slug}/images:
    get:
      tags:
        - Galleries
      summary: Get gallery images
      description: Retrieve all images in a gallery
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Images retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Image'

    post:
      tags:
        - Galleries
      summary: Add image to gallery
      description: Upload a new image to gallery (author only)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - url
              properties:
                url:
                  type: string
                  format: uri
                caption:
                  type: string
                  maxLength: 500
                order:
                  type: integer
                  minimum: 0
      responses:
        '201':
          description: Image added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /galleries/{slug}/images/{imageId}:
    patch:
      tags:
        - Galleries
      summary: Update image
      description: Update image caption or order (author only)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - name: imageId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                caption:
                  type: string
                  maxLength: 500
                order:
                  type: integer
                  minimum: 0
      responses:
        '200':
          description: Image updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Galleries
      summary: Delete image
      description: Remove image from gallery (author only)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
        - name: imageId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Image deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== COMMENTS ====================
  /comments/{id}:
    get:
      tags:
        - Comments
      summary: Get comment by ID
      description: Retrieve a specific comment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Comment retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Comments
      summary: Update comment
      description: Update comment content (author only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 5000
      responses:
        '200':
          description: Comment updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Comments
      summary: Delete comment
      description: Delete a comment (author only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Comment deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /comments/{id}/like:
    post:
      tags:
        - Comments
      summary: Like comment
      description: Like or unlike a comment (toggle)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Comment liked/unliked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  liked:
                    type: boolean
                  likes:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /comments/{id}/replies:
    get:
      tags:
        - Comments
      summary: Get comment replies
      description: Retrieve all replies to a comment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: Replies retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Comment'

  # ==================== VIDEOS ====================
  /videos:
    get:
      tags:
        - Videos
      summary: List videos
      description: Get paginated list of YouTube climbing videos
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: category
          in: query
          schema:
            type: string
            enum: [outdoor, indoor, competition, bouldering, tutorial, documentary, gear]
          description: Filter by category
        - name: durationCategory
          in: query
          schema:
            type: string
            enum: [short, medium, long]
          description: Filter by duration category
        - name: featured
          in: query
          schema:
            type: boolean
          description: Filter featured videos
        - name: search
          in: query
          schema:
            type: string
          description: Search in title and description
      responses:
        '200':
          description: Videos retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      results:
                        type: array
                        items:
                          $ref: '#/components/schemas/Video'

  /videos/{id}:
    get:
      tags:
        - Videos
      summary: Get video by ID
      description: Retrieve a specific video
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Video retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Video'
        '404':
          $ref: '#/components/responses/NotFound'

  /videos/featured:
    get:
      tags:
        - Videos
      summary: Get featured videos
      description: Retrieve all featured videos
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
          description: Number of videos to return
      responses:
        '200':
          description: Featured videos retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Video'

  # ==================== BOOKMARKS ====================
  /bookmarks:
    post:
      tags:
        - Bookmarks
      summary: Create bookmark
      description: Bookmark an item (post, gym, gallery, or video)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - contentType
                - objectId
              properties:
                contentType:
                  type: string
                  enum: [post, gym, gallery, video]
                objectId:
                  type: string
                  description: ID of the item to bookmark
      responses:
        '201':
          description: Bookmark created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Bookmark'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Item already bookmarked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /bookmarks/{id}:
    delete:
      tags:
        - Bookmarks
      summary: Delete bookmark
      description: Remove a bookmark
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Bookmark deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== SEARCH ====================
  /search:
    get:
      tags:
        - Search
      summary: Global search
      description: Search across posts, gyms, galleries, and users
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 1
          description: Search query
        - name: type
          in: query
          schema:
            type: string
            enum: [post, gym, gallery, user, all]
            default: all
          description: Content type to search
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: Search results retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  query:
                    type: string
                  total:
                    type: integer
                  results:
                    type: object
                    properties:
                      posts:
                        type: array
                        items:
                          $ref: '#/components/schemas/Post'
                      gyms:
                        type: array
                        items:
                          $ref: '#/components/schemas/Gym'
                      galleries:
                        type: array
                        items:
                          $ref: '#/components/schemas/Gallery'
                      users:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'

# ==================== COMPONENTS ====================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT authentication. Include the token in the Authorization header as "Bearer {token}"

  parameters:
    Page:
      name: page
      in: query
      description: Page number for pagination
      schema:
        type: integer
        minimum: 1
        default: 1

    PageSize:
      name: pageSize
      in: query
      description: Number of items per page
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

  schemas:
    # ==================== CORE MODELS ====================
    User:
      type: object
      properties:
        id:
          type: string
          example: "123"
        username:
          type: string
          example: climber123
        email:
          type: string
          format: email
          example: climber@example.com
        displayName:
          type: string
          nullable: true
          example: John Climber
        bio:
          type: string
          nullable: true
          example: Passionate climber and outdoor enthusiast
        avatar:
          type: string
          format: uri
          nullable: true
          example: https://cdn.example.com/avatars/user123.jpg
        climbingStartYear:
          type: string
          nullable: true
          example: "2018"
        frequentGym:
          type: string
          nullable: true
          example: Brooklyn Boulders
        favoriteRouteType:
          type: string
          nullable: true
          example: sport climbing
        socialLinks:
          $ref: '#/components/schemas/SocialLinks'
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-10-11T14:20:00Z"

    Post:
      type: object
      properties:
        id:
          type: string
          example: "456"
        title:
          type: string
          example: My First 5.12 Climb
        slug:
          type: string
          example: my-first-512-climb
        content:
          type: string
          description: Markdown formatted content
          example: "# Introduction\n\nToday I climbed my first 5.12 route..."
        summary:
          type: string
          example: An exciting story about my first 5.12 climb at Red Rock Canyon
        coverImage:
          type: string
          format: uri
          example: https://cdn.example.com/posts/cover123.jpg
        images:
          type: array
          items:
            type: string
            format: uri
          nullable: true
          example:
            - https://cdn.example.com/posts/img1.jpg
            - https://cdn.example.com/posts/img2.jpg
        author:
          $ref: '#/components/schemas/User'
        tags:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        likes:
          type: integer
          minimum: 0
          example: 42
        views:
          type: integer
          minimum: 0
          example: 256
        isPublished:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2024-10-01T08:15:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-10-01T09:30:00Z"

    Tag:
      type: object
      properties:
        id:
          type: string
          example: "789"
        name:
          type: string
          example: Bouldering
        slug:
          type: string
          example: bouldering
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"

    Gym:
      type: object
      properties:
        id:
          type: string
          example: "321"
        name:
          type: string
          example: Brooklyn Boulders
        slug:
          type: string
          example: brooklyn-boulders
        description:
          type: string
          example: Premier climbing gym with extensive bouldering and top-rope routes
        address:
          type: string
          example: 575 Degraw St, Brooklyn, NY 11217
        coverImage:
          type: string
          format: uri
          example: https://cdn.example.com/gyms/cover321.jpg
        images:
          type: array
          items:
            type: string
            format: uri
          nullable: true
          example:
            - https://cdn.example.com/gyms/img1.jpg
            - https://cdn.example.com/gyms/img2.jpg
        website:
          type: string
          format: uri
          nullable: true
          example: https://brooklynboulders.com
        phone:
          type: string
          nullable: true
          example: "+1-718-555-0123"
        openingHours:
          $ref: '#/components/schemas/OpeningHours'
        facilities:
          type: array
          items:
            type: string
          nullable: true
          example:
            - shower
            - locker
            - cafe
            - equipment_rental
        likes:
          type: integer
          minimum: 0
          example: 128
        rating:
          type: number
          format: float
          minimum: 0
          maximum: 5
          example: 4.5
        createdAt:
          type: string
          format: date-time
          example: "2024-02-15T12:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-09-20T16:45:00Z"

    Gallery:
      type: object
      properties:
        id:
          type: string
          example: "654"
        title:
          type: string
          example: Yosemite Summer Trip 2024
        slug:
          type: string
          example: yosemite-summer-trip-2024
        description:
          type: string
          nullable: true
          example: Amazing climbing trip to Yosemite National Park
        coverImage:
          type: string
          format: uri
          example: https://cdn.example.com/galleries/cover654.jpg
        author:
          $ref: '#/components/schemas/User'
        likes:
          type: integer
          minimum: 0
          example: 89
        views:
          type: integer
          minimum: 0
          example: 312
        createdAt:
          type: string
          format: date-time
          example: "2024-08-10T14:20:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-08-10T18:30:00Z"

    GalleryDetail:
      allOf:
        - $ref: '#/components/schemas/Gallery'
        - type: object
          properties:
            images:
              type: array
              items:
                $ref: '#/components/schemas/Image'

    Image:
      type: object
      properties:
        id:
          type: string
          example: "987"
        galleryId:
          type: string
          example: "654"
        url:
          type: string
          format: uri
          example: https://cdn.example.com/galleries/img987.jpg
        caption:
          type: string
          nullable: true
          maxLength: 500
          example: El Capitan at sunset
        order:
          type: integer
          minimum: 0
          example: 1
        createdAt:
          type: string
          format: date-time
          example: "2024-08-10T15:30:00Z"

    Comment:
      type: object
      properties:
        id:
          type: string
          example: "246"
        content:
          type: string
          example: Great post! Thanks for sharing your experience.
        author:
          $ref: '#/components/schemas/User'
        contentType:
          type: string
          enum: [post, gym, gallery, video]
          example: post
        objectId:
          type: string
          example: "456"
        parentId:
          type: string
          nullable: true
          example: null
        replies:
          type: array
          items:
            $ref: '#/components/schemas/Comment'
          description: Nested replies (only one level deep)
        likes:
          type: integer
          minimum: 0
          example: 12
        createdAt:
          type: string
          format: date-time
          example: "2024-10-02T09:15:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-10-02T09:15:00Z"

    Video:
      type: object
      properties:
        id:
          type: string
          example: "135"
        youtubeId:
          type: string
          example: dQw4w9WgXcQ
        title:
          type: string
          example: Adam Ondra Climbs Silence 9c
        description:
          type: string
          example: Watch Adam Ondra attempt the world's hardest climb
        thumbnailUrl:
          type: string
          format: uri
          example: https://i.ytimg.com/vi/dQw4w9WgXcQ/maxresdefault.jpg
        channel:
          type: string
          example: Adam Ondra Official
        channelId:
          type: string
          nullable: true
          example: UCcH_E8P5zmgF43xPNVIxUDQ
        publishedAt:
          type: string
          format: date-time
          example: "2024-06-15T10:00:00Z"
        duration:
          type: string
          example: "15:42"
        viewCount:
          type: string
          example: "1234567"
        category:
          type: string
          enum: [outdoor, indoor, competition, bouldering, tutorial, documentary, gear]
          example: outdoor
        durationCategory:
          type: string
          enum: [short, medium, long]
          example: medium
        tags:
          type: array
          items:
            type: string
          nullable: true
          example:
            - sport climbing
            - 9c
            - norway
        featured:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2024-06-16T08:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-06-16T08:00:00Z"

    Bookmark:
      type: object
      properties:
        id:
          type: string
          example: "753"
        userId:
          type: string
          example: "123"
        contentType:
          type: string
          enum: [post, gym, gallery, video]
          example: post
        objectId:
          type: string
          example: "456"
        contentObject:
          oneOf:
            - $ref: '#/components/schemas/Post'
            - $ref: '#/components/schemas/Gym'
            - $ref: '#/components/schemas/Gallery'
            - $ref: '#/components/schemas/Video'
          description: The bookmarked content object
        createdAt:
          type: string
          format: date-time
          example: "2024-10-05T11:20:00Z"

    # ==================== NESTED OBJECTS ====================
    SocialLinks:
      type: object
      nullable: true
      properties:
        instagram:
          type: string
          format: uri
          example: https://instagram.com/climber123
        facebook:
          type: string
          format: uri
          example: https://facebook.com/climber123
        twitter:
          type: string
          format: uri
          example: https://twitter.com/climber123
        website:
          type: string
          format: uri
          example: https://climber123.com

    OpeningHours:
      type: object
      nullable: true
      properties:
        monday:
          type: string
          example: "10:00-22:00"
        tuesday:
          type: string
          example: "10:00-22:00"
        wednesday:
          type: string
          example: "10:00-22:00"
        thursday:
          type: string
          example: "10:00-22:00"
        friday:
          type: string
          example: "10:00-23:00"
        saturday:
          type: string
          example: "09:00-23:00"
        sunday:
          type: string
          example: "09:00-21:00"

    TokenPair:
      type: object
      properties:
        access:
          type: string
          description: JWT access token (expires in 1 hour)
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiMTIzIiwiZXhwIjoxNjMwMDAwMDAwfQ.signature
        refresh:
          type: string
          description: JWT refresh token (expires in 7 days)
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiMTIzIiwiZXhwIjoxNjMwNjA0ODAwfQ.signature

    # ==================== RESPONSE WRAPPERS ====================
    PaginatedResponse:
      type: object
      properties:
        count:
          type: integer
          description: Total number of items
          example: 156
        next:
          type: string
          format: uri
          nullable: true
          description: URL to next page
          example: https://api.nobodyclimb.com/api/v1/posts?page=3
        previous:
          type: string
          format: uri
          nullable: true
          description: URL to previous page
          example: https://api.nobodyclimb.com/api/v1/posts?page=1
        results:
          type: array
          items: {}
          description: Array of result items

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: Resource not found
        details:
          type: object
          nullable: true
          description: Additional error details
          additionalProperties: true

    ValidationError:
      type: object
      properties:
        error:
          type: string
          example: Validation failed
        details:
          type: object
          description: Field-specific validation errors
          additionalProperties:
            type: array
            items:
              type: string
          example:
            email:
              - This field is required
            username:
              - Username must be between 3 and 150 characters

  # ==================== COMMON RESPONSES ====================
  responses:
    BadRequest:
      description: Bad request - validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'

    Unauthorized:
      description: Unauthorized - authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Authentication credentials were not provided

    Forbidden:
      description: Forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: You do not have permission to perform this action

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Resource not found
