# 功能規格文件

**版本**: 1.0
**日期**: 2025-12-30

---

## 目錄

1. [使用者認證系統](#1-使用者認證系統)
2. [攀岩場地資訊](#2-攀岩場地資訊)
3. [內容管理系統](#3-內容管理系統)
4. [社交互動](#4-社交互動)
5. [搜尋與發現](#5-搜尋與發現)
6. [個人檔案](#6-個人檔案)
7. [影片內容聚合](#7-影片內容聚合)
8. [通知系統](#8-通知系統)

---

## 1. 使用者認證系統

### 1.1 使用者註冊

**功能描述**: 允許新使用者建立帳號

**使用者故事**:
```
作為一個新使用者
我想要註冊帳號
以便我可以使用平台的完整功能
```

**接受標準**:
- [ ] 使用者可以使用 Email + 密碼註冊
- [ ] Email 格式驗證
- [ ] 密碼強度要求 (最少 8 位，包含字母和數字)
- [ ] 使用者協議和隱私政策同意
- [ ] Email 驗證機制 (發送驗證郵件)
- [ ] 防止重複註冊 (Email 唯一性檢查)
- [ ] 註冊成功後自動登入

**UI/UX 要求**:
- 簡潔的註冊表單 (Email, 密碼, 確認密碼, 使用者名)
- 即時表單驗證和錯誤提示
- 密碼強度指示器
- 社交帳號註冊選項 (Google, Facebook)

**API 端點**:
```
POST /api/auth/register
Request: {
  "email": "user@example.com",
  "password": "password123",
  "username": "climber01"
}
Response: {
  "token": "jwt_token",
  "user": { "id", "email", "username" }
}
```

### 1.2 使用者登入

**功能描述**: 已註冊使用者登入系統

**使用者故事**:
```
作為一個已註冊使用者
我想要登入我的帳號
以便訪問我的個人內容和設定
```

**接受標準**:
- [ ] Email + 密碼登入
- [ ] "記住我" 選項 (延長 token 有效期)
- [ ] 社交帳號登入 (Google, Facebook)
- [ ] 錯誤提示 (帳號不存在、密碼錯誤)
- [ ] 登入後重定向到原頁面或首頁

**API 端點**:
```
POST /api/auth/login
Request: {
  "email": "user@example.com",
  "password": "password123"
}
Response: {
  "token": "jwt_token",
  "user": { ... }
}
```

### 1.3 多步驟個人資料設定

**功能描述**: 新使用者完成註冊後的引導式檔案設定

**使用者旅程**:
1. **步驟 1**: 基本資訊 (姓名、性別、生日)
2. **步驟 2**: 攀岩經驗 (經驗等級、喜好類型)
3. **步驟 3**: 個人介紹 (簡介、興趣、目標)
4. **步驟 4**: 上傳頭像
5. **步驟 5**: 完成設定

**接受標準**:
- [ ] 漸進式多步驟表單
- [ ] 進度指示器
- [ ] 每步可以跳過 (後續可在設定中完成)
- [ ] 自動保存草稿
- [ ] 完成後獲得"新手獎勵" (徽章、積分等)

---

## 2. 攀岩場地資訊

### 2.1 攀岩館列表

**功能描述**: 展示所有攀岩館資訊，支援篩選和搜尋

**使用者故事**:
```
作為一個攀岩愛好者
我想要瀏覽附近的攀岩館
以便找到適合我的場地
```

**接受標準**:
- [ ] 攀岩館卡片視圖 (名稱、地址、照片、評分)
- [ ] 地區篩選 (下拉選單或標簽)
- [ ] 搜尋功能 (名稱、地址關鍵字)
- [ ] 地圖視圖模式 (Google Maps 整合)
- [ ] 排序選項 (距離、評分、名稱)
- [ ] 分頁或無限捲動加載

**篩選選項**:
- 地區 (台北、新北、台中、台南、高雄等)
- 設施類型 (抱石、上攀、自動確保等)
- 營業狀態 (營業中、即將開放、暫停營業)
- 評分 (4 星以上、3 星以上等)

**UI 組件**:
- 攀岩館卡片: 照片、名稱、地址、評分、距離、"查看詳情" 按鈕
- 篩選側邊欄 (桌面) 或抽屜 (移動)
- 地圖/列表切換按鈕

**API 端點**:
```
GET /api/gyms?region=taipei&type=bouldering&page=1
Response: {
  "gyms": [ { id, name, address, rating, images, ... } ],
  "pagination": { page, totalPages, totalCount }
}
```

### 2.2 攀岩館詳情頁

**功能描述**: 展示單個攀岩館的完整資訊

**頁面章節**:
1. **基本資訊**: 名稱、地址、電話、營業時間、官網連結
2. **設施介紹**: 攀岩墻類型、高度、路線數量、設施照片
3. **價格資訊**: 單次票價、月卡、年卡、租賃裝備價格
4. **使用者評價**: 評分、評論列表、寫評論功能
5. **相片集**: 使用者上傳的攀岩館照片
6. **地圖位置**: 嵌入式地圖、導覽連結

**接受標準**:
- [ ] 完整的攀岩館資訊展示
- [ ] 照片輪播或畫廊視圖
- [ ] 使用者可以評分 (1-5 星) 和留言
- [ ] 收藏/書簽功能
- [ ] 分享功能 (社交媒體分享)
- [ ] 相關攀岩館推薦

**互動功能**:
- 點擊地址打開地圖導覽
- 點擊電話號碼撥打
- 點擊官網連結跳轉
- 照片點擊放大查看

### 2.3 戶外岩場資訊

**功能描述**: 展示戶外自然岩場資訊和攀岩路線

**特殊需求**:
- **路線資訊**: 路線名稱、難度評級 (YDS/French)、類型 (Sport/Trad)、長度
- **安全資訊**: 路況、天氣警告、裝備建議、緊急聯絡
- **照片標註**: 路線位置標記、關鍵動作提示
- **使用者貢獻**: 允許使用者新增路線、更新資訊、上傳照片

**資料來源**:
- CSV 文件 (現有: Kenting, Guanziling, Defulan 等地區)
- 使用者提交 (需審核)
- 第三方 API (Mountain Project 等，未來可能)

**CSV 資料結構** (參考 `docs/route-data-refactor/`):
```csv
route_id,name_zh,name_en,grade,type,length,description_zh,description_en
```

---

## 3. 內容管理系統

### 3.1 部落格文章

**功能描述**: 使用者建立和發布攀岩相關文章

**文章類型**:
- 攀岩教學 (技巧、訓練、裝備評測)
- 攀岩遊記 (岩場探訪、旅行日志)
- 個人經驗分享 (心得、故事、挑戰)
- 新聞資訊 (賽事、活動、產業動態)

**建立/編輯流程**:
1. **起草**: 標題、內容、標簽、封面圖片
2. **預覽**: 查看發布後的效果
3. **發布**: 立即發布或定時發布
4. **管理**: 編輯、刪除、設為草稿

**接受標準**:
- [ ] 富文本編輯器 (標題、粗體、斜體、列表、引用、代碼塊)
- [ ] 圖片上傳和嵌入
- [ ] YouTube/Instagram 影片嵌入
- [ ] 標簽選擇 (多選、自動補全)
- [ ] SEO 設定 (Meta 標題、描述)
- [ ] 草稿自動保存 (每 30 秒)
- [ ] 發布權限控制 (草稿、公開、私密)

**UI 組件**:
- 編輯器工具欄 (格式化按鈕)
- 側邊欄 (標簽、封面圖片、SEO 設定)
- 預覽面板 (即時預覽或彈窗預覽)

**API 端點**:
```
POST /api/posts
PUT /api/posts/:id
DELETE /api/posts/:id
GET /api/posts/:id
GET /api/posts?tag=tutorial&page=1
```

### 3.2 相片集

**功能描述**: 使用者上傳和分享攀岩照片

**功能特性**:
- **相片上傳**: 拖放或選擇文件，支援多張批量上傳
- **相片編輯**: 裁剪、旋轉、調整亮度/對比度 (可選)
- **相簿管理**: 建立相簿、分類照片、設定封面
- **標簽和描述**: 為照片添加標簽、地點、日期、描述
- **隱私設定**: 公開、僅好友、私密

**瀏覽體驗**:
- 瀑布流布局 (Pinterest 風格)
- 燈箱彈出查看 (支援鍵盤導覽)
- 照片詳情頁 (高分辨率、EXIF 資訊、評論)
- 點讚和評論

**接受標準**:
- [ ] 支援常見圖片格式 (JPG, PNG, HEIC, WebP)
- [ ] 圖片自動最佳化 (壓縮、格式轉換)
- [ ] 最大文件大小限制 (10MB/張)
- [ ] 上傳進度顯示
- [ ] 批量操作 (批量刪除、移動相簿)

---

## 4. 社交互動

### 4.1 評論系統

**功能描述**: 使用者對內容進行評論和討論

**評論對象**:
- 部落格文章
- 攀岩館/岩場
- 相片
- 影片

**功能特性**:
- **發表評論**: 文字評論 (最多 500 字)
- **回覆評論**: 嵌套回複 (最多 2 層)
- **點讚評論**: 為評論點讚
- **檢舉評論**: 檢舉不當內容
- **編輯/刪除**: 使用者可以編輯/刪除自己的評論

**接受標準**:
- [ ] 即時評論顯示
- [ ] Markdown 支援 (可選)
- [ ] @提及使用者 (可選)
- [ ] 評論排序 (最新、最熱、最早)
- [ ] 評論分頁 (每頁 20 條)
- [ ] 防垃圾評論機制 (頻率限制、敏感詞過濾)

**UI 組件**:
- 評論輸入框 (自動擴充高度)
- 評論列表 (頭像、使用者名、時間、內容、操作按鈕)
- 回複框 (點擊"回複"展開)

### 4.2 點讚與收藏

**功能描述**: 使用者表達喜愛和保存內容

**點讚 (Like)**:
- 一鍵點讚/取消點讚
- 顯示點讚數量
- 點讚使用者列表 (點擊查看誰點了讚)

**收藏 (Bookmark)**:
- 收藏到個人書簽
- 建立收藏夾分類 (教學、遊記、器材等)
- 在個人檔案查看所有收藏

**接受標準**:
- [ ] 樂觀更新 (立即反映 UI 變化)
- [ ] 防止重複點讚
- [ ] 收藏夾管理 (建立、重命名、刪除)
- [ ] 快捷鍵支持 (L 鍵點讚, B 鍵收藏)

### 4.3 使用者追蹤 (Follow)

**功能描述**: 關註其他使用者，獲得其動態更新

**功能特性**:
- **追蹤使用者**: 點擊"追蹤"按鈕關註使用者
- **追蹤者/追蹤中列表**: 查看追蹤者和正在追蹤的使用者
- **動態通知**: 追蹤的使用者發布新內容時收到通知
- **推薦使用者**: 基於興趣推薦值得關註的使用者

**接受標準**:
- [ ] 雙向追蹤關系 (可以互相追蹤)
- [ ] 私密帳號支持 (需批準追蹤請求)
- [ ] 屏蔽功能 (屏蔽特定使用者)
- [ ] 追蹤者數量顯示

---

## 5. 搜尋與發現

### 5.1 全站搜尋

**功能描述**: 跨類型內容的綜合搜尋

**搜尋範圍**:
- 文章 (標題、內容、標簽)
- 使用者 (使用者名、簡介)
- 攀岩館/岩場 (名稱、地址)
- 相片 (標簽、描述)
- 影片 (標題、描述)

**搜尋功能**:
- **即時搜尋**: 輸入時顯示建議
- **進階篩選**: 按類型、日期、作者篩選
- **搜尋歷史**: 保存最近搜尋記錄
- **熱門搜尋**: 顯示熱門搜尋詞

**接受標準**:
- [ ] 搜尋回應時間 < 500ms
- [ ] 支援中文分詞和模糊搜尋
- [ ] 高亮顯示搜尋關鍵字
- [ ] 搜尋結果分頁
- [ ] 無結果時提供建議 ("您是否要找...")

**UI 組件**:
- 搜尋欄 (導覽欄或獨立頁面)
- 搜尋建議下拉 (顯示歷史 + 即時建議)
- 結果分類 Tab (全部、文章、使用者、場地等)
- 篩選側邊欄

### 5.2 內容推薦

**功能描述**: 基於使用者興趣的個人化內容推薦

**推薦演算法** (簡化版):
1. **協同過濾**: 基於相似使用者的喜好
2. **內容相似度**: 基於標簽、類型、作者
3. **熱度排序**: 基於瀏覽量、點讚數、評論數
4. **時間衰減**: 新內容獲得更高權重

**推薦位置**:
- 首頁 "為你推薦" 區塊
- 文章詳情頁 "相關文章"
- 使用者檔案 "可能認識的人"

**接受標準**:
- [ ] 新使用者冷啟動策略 (推薦熱門內容)
- [ ] 推薦多樣性 (避免推薦過於相似的內容)
- [ ] 使用者反饋機制 ("不感興趣"、"查看更多類似內容")

---

## 6. 個人檔案

### 6.1 檔案頁面

**功能描述**: 展示使用者的個人資訊和內容

**頁面章節**:
1. **個人資訊**: 頭像、使用者名、簡介、攀岩經驗、社交連結
2. **統計資料**: 發文數、追蹤者、追蹤中、收藏數
3. **內容 Tab**:
   - 文章 (發布的所有文章)
   - 相片 (上傳的照片)
   - 收藏 (收藏的內容)
   - 攀登記錄 (未來功能)

**接受標準**:
- [ ] 公開/私密檔案切換
- [ ] 編輯檔案功能 (僅本人可見)
- [ ] 回應式設計 (移動/桌面)
- [ ] 分享檔案連結

**UI 組件**:
- 封面圖片 (可自定義)
- 頭像 (可上傳、裁剪)
- Tab 導覽 (文章、相片、收藏等)
- "編輯檔案" 按鈕 (本人) 或 "追蹤" 按鈕 (他人)

### 6.2 檔案設定

**功能描述**: 使用者管理個人設定

**設定分類**:
1. **個人資訊**: 使用者名、Email、密碼、頭像、簡介
2. **隱私設定**: 檔案公開/私密、評論權限、消息權限
3. **通知設定**: Email 通知、推播通知、通知類型選擇
4. **帳號管理**: 停用帳號、刪除帳號、資料導出
5. **顯示偏好**: 明暗模式、語言 (繁/簡中文)

**接受標準**:
- [ ] 表單驗證
- [ ] 修改後立即生效
- [ ] 敏感操作需確認 (刪除帳號、修改密碼)
- [ ] 修改 Email 需驗證

---

## 7. 影片內容聚合

### 7.1 YouTube 影片瀏覽

**功能描述**: 聚合多個攀岩相關 YouTube 頻道的影片

**影片來源**:
- 設定的 YouTube 頻道列表 (`scripts/channels.json`)
- 定期自動更新 (通過 YouTube Data API)

**功能特性**:
- **影片列表**: 卡片式布局，顯示縮略圖、標題、頻道、時長、發布日期
- **分類篩選**:
  - 類型 (戶外攀岩、室內攀岩、競技攀岩、教學影片、紀錄片)
  - 時長 (短影片 <10min, 中等 10-30min, 長影片 >30min)
  - 發布日期 (今天、本周、本月、今年)
- **搜尋功能**: 搜尋影片標題和描述
- **播放器**: 嵌入式 YouTube 播放器
- **相關影片**: 顯示相關推薦影片

**接受標準**:
- [ ] 影片資料自動更新 (每日執行腳本)
- [ ] 回應式影片播放器 (16:9 比例)
- [ ] 播放歷史記錄
- [ ] 收藏影片到個人書簽

**資料流程**:
1. `collect-youtube-data.sh` - 從 YouTube API 收集影片元資料
2. `convert-youtube-videos.js` - 轉換和清理資料
3. `merge-video-sources.js` - 合並多個資料源
4. `public/data/videos.json` - 前端讀取靜態 JSON
5. (未來) Cloudflare KV - 遷移到 KV 存儲

**API 端點** (未來):
```
GET /api/videos?category=outdoor&duration=short&page=1
Response: {
  "videos": [ { id, title, channelTitle, thumbnails, duration, ... } ],
  "pagination": { ... }
}
```

### 7.2 Instagram 影片嵌入

**功能描述**: 在文章或相片集中嵌入 Instagram 影片

**實作方式**:
- Instagram Embed API
- 回應式 iframe 嵌入
- 支援 oEmbed 格式

**接受標準**:
- [ ] 輸入 Instagram URL 自動嵌入
- [ ] 回應式布局 (移動/桌面)
- [ ] 加載最佳化 (懶加載)

參考: `docs/ig-show-video/`

---

## 8. 通知系統

### 8.1 通知類型

**系統通知**:
- 新追蹤者
- 文章被點讚/評論
- 評論被回複
- @提及
- 活動提醒 (未來)

**通知渠道**:
- 站內通知 (通知中心)
- Email 通知 (可選)
- 推播通知 (PWA, 未來)

### 8.2 通知中心

**功能特性**:
- 未讀通知計數徽章
- 通知列表 (時間倒序)
- 標記為已讀/未讀
- 批量操作 (全部標為已讀、清空通知)
- 通知跳轉到相關內容

**接受標準**:
- [ ] 即時通知更新 (WebSocket 或輪詢)
- [ ] 通知分頁
- [ ] 通知保留 30 天

---

## 9. 使用者旅程圖

### 9.1 新使用者首次訪問

```
訪問首頁 → 瀏覽內容 → 點擊"註冊" → 填寫資訊 → Email 驗證
→ 多步驟檔案設定 → 查看推薦內容 → 追蹤感興趣的使用者
→ 搜尋附近攀岩館 → 收藏攀岩館 → 閱讀教學文章
→ 發表第一篇評論 → 完成新手任務 (獲得徽章)
```

### 9.2 老使用者回訪

```
登入 → 查看通知 → 瀏覽追蹤使用者的最新動態
→ 點讚和評論 → 搜尋攀岩場地 → 規劃周末攀岩行程
→ 發布攀岩照片 → 撰寫遊記文章 → 分享到社交媒體
→ 回複評論 → 登出
```

### 9.3 內容創作者工作流程

```
登入 → 進入文章編輯器 → 撰寫攀岩教學文章
→ 上傳示範圖片 → 嵌入 YouTube 教學影片
→ 添加標簽 → 預覽文章 → 發布 → 分享到社交媒體
→ 查看文章資料 (瀏覽量、點讚數) → 回複讀者評論
→ 更新文章內容 → 規劃下一篇文章
```

---

## 10. 接口規範

詳細的 API 接口規範請參考:
- `/specs/001-django-rest-framework/spec.md`
- `/docs/backend/03-api-implementation-guide.md`

---

**文件結束**
